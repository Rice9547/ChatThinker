# LINE Bot 聊天優化機器人使用說明

## 🎯 功能簡介
這個 LINE Bot 可以幫助你優化對話內容，支援兩種模式：
1. **生成模式**：根據你提供的資訊直接生成對話內容
2. **潤飾模式**：優化你提供的對話草稿

## 📋 使用流程

### 1. 開始新對話
輸入 `/new` 開始使用

### 2. 提供基本資訊
Bot 會依序詢問：
- **你是誰？** (例如：我是一個大學生)
- **對話對象是誰？** (例如：我的教授)
- **說話情境？** (例如：請教課業問題)
- **過去對話紀錄？** (如果沒有請輸入「無」)

### 3. 選擇模式
- 輸入 **「生成」** → 直接生成對話內容
- 輸入 **「潤飾」** → 提供你的草稿讓 Bot 優化

### 4. 獲得更多建議
- 輸入 `/more` → 基於相同條件生成更多版本的對話

## 🔧 部署設置

### 必要條件
1. LINE Developer Account
2. OpenAI API Key
3. Redis Server

### 設置步驟

#### 1. LINE Bot 設置
1. 前往 [LINE Developers](https://developers.line.biz/)
2. 創建新的 Provider 和 Channel
3. 在 Channel 設置中：
   - 取得 **Channel Access Token**
   - 取得 **Channel Secret**
   - 設置 Webhook URL: `https://你的網址/callback`
   - 啟用 **Use webhook**

#### 2. 環境變數設置
編輯 `.env` 檔案：
```bash
LINE_CHANNEL_ACCESS_TOKEN=你的Channel_Access_Token
LINE_CHANNEL_SECRET=你的Channel_Secret
OPENAI_API_KEY=你的OpenAI_API_Key
REDIS_URL=redis://localhost:6379/0
```

#### 3. 啟動服務
```bash
# 啟動 Redis
brew services start redis

# 啟動應用 (開發模式)
python3 run.py

# 或使用 Gunicorn (生產模式)
gunicorn --bind 0.0.0.0:5000 app:app
```

## 📱 使用範例

### 情境一：請教老師問題
```
用戶: /new
Bot: 開始新的對話！請告訴我：你是誰？

用戶: 我是資工系二年級學生
Bot: 了解，你是：我是資工系二年級學生
     請告訴我對話對象是誰？

用戶: 我的演算法課教授
Bot: 了解，對象是：我的演算法課教授
     請描述對話情境

用戶: 想請教動態規劃的問題
Bot: 了解，情境是：想請教動態規劃的問題
     請提供過去的對話紀錄

用戶: 無
Bot: 資料收集完成！請選擇模式：
     1. 輸入「生成」- 我會直接為你生成對話內容
     2. 輸入「潤飾」- 請提供你的對話草稿，我會幫你優化

用戶: 生成
Bot: [生成適當的對話內容]

用戶: /more
Bot: [生成另一個版本的對話]
```

### 情境二：潤飾對話草稿
```
用戶: /new
[... 相同的資料收集流程 ...]

用戶: 潤飾
Bot: 請提供你的對話草稿：

用戶: 老師，我有個問題想問你關於DP...
Bot: [優化後的對話內容]
```

## 🚀 進階功能

### 指令列表
- `/new` - 開始新對話
- `/more` - 生成更多內容版本

### 狀態管理
- 每個用戶的對話狀態獨立保存在 Redis 中
- 會話過期時間：24小時
- 支援多用戶同時使用

## 🛠 技術架構

### 核心組件
- **Flask** - Web 框架
- **LINE Bot SDK** - LINE 機器人開發
- **LangChain + OpenAI** - AI 對話生成
- **Redis** - 會話狀態管理

### 檔案結構
```
chatbot/
├── app.py              # 主應用程式
├── chat_processor.py   # AI 對話處理
├── session_manager.py  # 會話管理
├── requirements.txt    # 依賴套件
├── .env.example       # 環境變數範本
├── run.py             # 啟動腳本
└── test_setup.py      # 測試腳本
```

## 🔍 故障排除

### 常見問題

**Q: Redis 連接失敗**
A: 檢查 Redis 是否運行：`redis-cli ping`

**Q: LINE Webhook 驗證失敗**
A: 確認 Channel Secret 設置正確

**Q: OpenAI API 錯誤**
A: 檢查 API Key 和帳戶餘額

**Q: 應用無法啟動**
A: 運行 `python3 test_setup.py` 檢查環境