from linebot.models import (
    FlexSendMessage, BubbleContainer, BoxComponent, 
    TextComponent, ButtonComponent, SeparatorComponent,
    CarouselContainer, URIAction, PostbackAction,
    MessageAction
)

class FlexMessageBuilder:
    """Âª∫Á´ã LINE Flex Message Âç°Áâá"""
    
    @staticmethod
    def create_reply_options_carousel(options):
        """Âª∫Á´ãÂõûË¶ÜÈÅ∏È†ÖÁöÑËº™Êí≠Âç°Áâá"""
        bubbles = []
        
        for idx, option in enumerate(options):
            bubble = BubbleContainer(
                size='kilo',
                header=BoxComponent(
                    layout='vertical',
                    contents=[
                        BoxComponent(
                            layout='horizontal',
                            contents=[
                                TextComponent(
                                    text=option['emoji'],
                                    size='sm',
                                    flex=0
                                ),
                                TextComponent(
                                    text=option['title'],
                                    weight='bold',
                                    color='#1DB446',
                                    size='sm',
                                    flex=1,
                                    margin='md'
                                )
                            ]
                        )
                    ],
                    backgroundColor='#F0F0F0',
                    paddingAll='10px'
                ),
                body=BoxComponent(
                    layout='vertical',
                    contents=[
                        TextComponent(
                            text=option['text'],
                            wrap=True,
                            size='sm',
                            color='#333333'
                        )
                    ],
                    paddingAll='15px'
                ),
                footer=BoxComponent(
                    layout='vertical',
                    contents=[
                        ButtonComponent(
                            action=MessageAction(
                                label='üìã ‰ΩøÁî®ÈÄôÂÄã',
                                text=option['text']
                            ),
                            style='primary',
                            color='#1DB446',
                            height='sm'
                        ),
                        ButtonComponent(
                            action=PostbackAction(
                                label='‚úèÔ∏è Ë™øÊï¥Ë™ûÊ∞£',
                                data=f'action=adjust_tone&index={idx}&style={option["style"]}'
                            ),
                            style='secondary',
                            height='sm',
                            margin='sm'
                        )
                    ],
                    spacing='sm',
                    paddingAll='10px'
                )
            )
            bubbles.append(bubble)
        
        carousel = CarouselContainer(contents=bubbles)
        return FlexSendMessage(alt_text='ÂõûË¶ÜÈÅ∏È†Ö', contents=carousel)
    
    @staticmethod
    def create_quick_scenarios_menu():
        """Âª∫Á´ãÂø´ÈÄüÊÉÖÂ¢ÉÈÅ∏ÂñÆ"""
        bubble = BubbleContainer(
            header=BoxComponent(
                layout='vertical',
                contents=[
                    TextComponent(
                        text='üöÄ Âø´ÈÄüÊÉÖÂ¢É',
                        weight='bold',
                        size='md',
                        color='#FFFFFF'
                    )
                ],
                backgroundColor='#1DB446',
                paddingAll='15px'
            ),
            body=BoxComponent(
                layout='vertical',
                contents=[
                    TextComponent(
                        text='ÈÅ∏ÊìáÂ∏∏Ë¶ãÊÉÖÂ¢ÉÔºåÁ´ãÂç≥Áç≤ÂæóÂõûË¶ÜÂª∫Ë≠∞Ôºö',
                        size='sm',
                        color='#666666',
                        wrap=True
                    ),
                    SeparatorComponent(margin='md'),
                    
                    # Ë´ãÂÅá
                    BoxComponent(
                        layout='horizontal',
                        contents=[
                            TextComponent(text='üè•', flex=0, size='lg'),
                            ButtonComponent(
                                action=PostbackAction(
                                    label='Ë´ãÂÅá',
                                    data='scenario=Ë´ãÂÅá'
                                ),
                                flex=1,
                                style='link',
                                height='sm'
                            )
                        ],
                        margin='md',
                        spacing='md'
                    ),
                    
                    # ÊãíÁµïÂä†Áè≠
                    BoxComponent(
                        layout='horizontal',
                        contents=[
                            TextComponent(text='üåô', flex=0, size='lg'),
                            ButtonComponent(
                                action=PostbackAction(
                                    label='ÊãíÁµïÂä†Áè≠',
                                    data='scenario=ÊãíÁµïÂä†Áè≠'
                                ),
                                flex=1,
                                style='link',
                                height='sm'
                            )
                        ],
                        spacing='md'
                    ),
                    
                    # ÂÇ¨ÈÄ≤Â∫¶
                    BoxComponent(
                        layout='horizontal',
                        contents=[
                            TextComponent(text='‚è∞', flex=0, size='lg'),
                            ButtonComponent(
                                action=PostbackAction(
                                    label='ÂÇ¨ÈÄ≤Â∫¶',
                                    data='scenario=ÂÇ¨ÈÄ≤Â∫¶'
                                ),
                                flex=1,
                                style='link',
                                height='sm'
                            )
                        ],
                        spacing='md'
                    ),
                    
                    # ÈÅìÊ≠â
                    BoxComponent(
                        layout='horizontal',
                        contents=[
                            TextComponent(text='üôè', flex=0, size='lg'),
                            ButtonComponent(
                                action=PostbackAction(
                                    label='ÈÅìÊ≠â',
                                    data='scenario=ÈÅìÊ≠â'
                                ),
                                flex=1,
                                style='link',
                                height='sm'
                            )
                        ],
                        spacing='md'
                    ),
                    
                    # Ëá™Ë®Ç
                    BoxComponent(
                        layout='horizontal',
                        contents=[
                            TextComponent(text='üí≠', flex=0, size='lg'),
                            ButtonComponent(
                                action=MessageAction(
                                    label='Ëá™Ë®ÇÊÉÖÂ¢É',
                                    text='ÊàëË¶ÅËá™Ë®ÇÊÉÖÂ¢É'
                                ),
                                flex=1,
                                style='link',
                                height='sm'
                            )
                        ],
                        spacing='md'
                    )
                ],
                spacing='sm',
                paddingAll='20px'
            )
        )
        
        return FlexSendMessage(alt_text='Âø´ÈÄüÊÉÖÂ¢ÉÈÅ∏ÂñÆ', contents=bubble)
    
    @staticmethod
    def create_tone_adjustment_menu(original_text):
        """Âª∫Á´ãË™ûÊ∞£Ë™øÊï¥ÈÅ∏ÂñÆ"""
        bubble = BubbleContainer(
            header=BoxComponent(
                layout='vertical',
                contents=[
                    TextComponent(
                        text='‚úèÔ∏è Ë™øÊï¥Ë™ûÊ∞£',
                        weight='bold',
                        size='md',
                        color='#FFFFFF'
                    )
                ],
                backgroundColor='#FF6B6B',
                paddingAll='15px'
            ),
            body=BoxComponent(
                layout='vertical',
                contents=[
                    TextComponent(
                        text='ÂéüÊñáÔºö',
                        size='xs',
                        color='#999999'
                    ),
                    TextComponent(
                        text=original_text[:50] + '...' if len(original_text) > 50 else original_text,
                        size='sm',
                        wrap=True,
                        margin='sm'
                    ),
                    SeparatorComponent(margin='md'),
                    TextComponent(
                        text='ÈÅ∏ÊìáÊÉ≥Ë¶ÅÁöÑË™ûÊ∞£Ôºö',
                        size='sm',
                        color='#666666',
                        margin='md'
                    ),
                    
                    BoxComponent(
                        layout='vertical',
                        contents=[
                            ButtonComponent(
                                action=PostbackAction(
                                    label='üëî Êõ¥Ê≠£Âºè',
                                    data=f'tone=formal&text={original_text[:100]}'
                                ),
                                style='secondary',
                                height='sm'
                            ),
                            ButtonComponent(
                                action=PostbackAction(
                                    label='üòä Êõ¥ËºïÈ¨Ü',
                                    data=f'tone=casual&text={original_text[:100]}'
                                ),
                                style='secondary',
                                height='sm',
                                margin='sm'
                            ),
                            ButtonComponent(
                                action=PostbackAction(
                                    label='ü§ù Êõ¥ÂßîÂ©â',
                                    data=f'tone=polite&text={original_text[:100]}'
                                ),
                                style='secondary',
                                height='sm',
                                margin='sm'
                            ),
                            ButtonComponent(
                                action=PostbackAction(
                                    label='üí™ Êõ¥Áõ¥Êé•',
                                    data=f'tone=direct&text={original_text[:100]}'
                                ),
                                style='secondary',
                                height='sm',
                                margin='sm'
                            )
                        ],
                        margin='md',
                        spacing='sm'
                    )
                ],
                paddingAll='20px'
            )
        )
        
        return FlexSendMessage(alt_text='Ë™øÊï¥Ë™ûÊ∞£', contents=bubble)
    
    @staticmethod
    def create_simple_reply_card(text, title="Âª∫Ë≠∞ÂõûË¶Ü"):
        """Âª∫Á´ãÁ∞°ÂñÆÁöÑÂõûË¶ÜÂç°ÁâáÔºàÂñÆ‰∏ÄÈÅ∏È†ÖÔºâ"""
        bubble = BubbleContainer(
            size='kilo',
            body=BoxComponent(
                layout='vertical',
                contents=[
                    TextComponent(
                        text=title,
                        weight='bold',
                        size='sm',
                        color='#1DB446'
                    ),
                    TextComponent(
                        text=text,
                        wrap=True,
                        size='md',
                        margin='md'
                    )
                ],
                paddingAll='20px'
            ),
            footer=BoxComponent(
                layout='horizontal',
                contents=[
                    ButtonComponent(
                        action=MessageAction(
                            label='üìã Ë§áË£Ω‰ΩøÁî®',
                            text=text
                        ),
                        style='primary',
                        color='#1DB446'
                    )
                ],
                paddingAll='10px'
            )
        )
        
        return FlexSendMessage(alt_text=title, contents=bubble)